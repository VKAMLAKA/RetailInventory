package com.example.RetailInventory;

import com.google.cloud.vertexai.VertexAI;
import com.google.cloud.vertexai.api.*;
import com.google.cloud.vertexai.generativeai.*;
import com.google.protobuf.ByteString;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Base64;
import java.util.List;

@SpringBootApplication
public class RetailInventoryApplication {

	public static void main(String[] args) throws IOException {
		SpringApplication.run(RetailInventoryApplication.class, args);
		// TODO(developer): Replace these variables before running the sample.
		String projectId = "cap-neural-ninjas";
		String location = "asia-northeast1";
		String modelName = "gemini-1.0-pro-vision-001";

		String output = generateContent(projectId, location, modelName);
		System.out.println(output);

		parseImage(projectId,location);
	}

	public static String generateContent(String projectId, String location, String modelName) throws IOException {

		try (VertexAI vertexAI = new VertexAI(projectId, location)) {

			GenerationConfig generationConfig =
					GenerationConfig.newBuilder()
							.setMaxOutputTokens(2048)
							.setTemperature(0.0F)
							.setTopK(32)
							.setTopP(1)
							.build();

			GenerativeModel model = new GenerativeModel(modelName, generationConfig, vertexAI);

			GenerateContentResponse response = model.generateContent("based on below previous sales, expiry date, and current available stock, give me some discount offers.\\n\\nincrease discount for nearing expiry products.\\nfor fresh products, same price as sold before.\\nignore expired products.\\ngive new prices with offers for each product for fresh and nearly expired items.\\nconsider previous sales data for applying offers - For products having more sell, less discount for nearly expiring.\\nFor products with less sell, more discount for nearly expiring.\\n\\n\\nProduct: Apples, Previous sold quantity: 20, prices: 10 rs per piece\\nProduct: Mango, Previous sold quantity: 10, prices: 50 rs per piece\\n\\nCurrent available stock with expiry dates:\\n\\nApple: 20 fresh, 10 (expiry in 5 days), 5(Expiry in 2 days), 5 expired\\nmango: 20 fresh, 10 (expiry in 5 days), 5(Expiry in 2 days), 5 expired");
			String output = ResponseHandler.getText(response);
			return output;
		}
	}

	public static void parseImage(String projectId, String location) throws IOException {
		try (VertexAI vertexAI = new VertexAI(projectId, location)) {

			GenerationConfig generationConfig =
					GenerationConfig.newBuilder()
							.setMaxOutputTokens(2048)
							.setTemperature(0.4F)
							.setTopK(32)
							.setTopP(1)
							.build();

			GenerativeModel model = new GenerativeModel("gemini-1.0-pro-vision-001", generationConfig, vertexAI);

			String textPromt="what is expiry date of given product?";

//			Content content = ContentMaker.fromMultiModalData(
//					textPromt,
//					PartMaker.fromMimeTypeAndData("image/jpg", "gs://images-for-data-fetch/bis2.jpg")
//			);
//			ResponseStream<GenerateContentResponse> response = model.generateContentStream(content);
//			response.stream().forEach(System.out::println);

			List<Content> contents = new ArrayList<>();
			contents.add(Content.newBuilder().setRole("user").addParts(Part.newBuilder().setInlineData(Blob.newBuilder().setMimeType("image/jpeg").
					setData(ByteString.copyFrom(Base64.getDecoder().decode("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"))))).
					addParts(Part.newBuilder().setText("what is expiry date of given product?")).build());

			ResponseStream<GenerateContentResponse> responseStream = model.generateContentStream(contents);
			responseStream.stream().forEach(System.out::println);
		}

	}


}
